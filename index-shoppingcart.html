<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>食趣 - 一人的食材外送</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
    <link href="vendor/simple-line-icons/css/simple-line-icons.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- Custom styles for this template -->
    <link href="css/landing-page.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/shoppingcart.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script>
        const headers = {
            headers: {
                "Authorization": "Bearer keyabYPbrYnSWmK9v"
            }
        };
        const getShoppingcartListAPI = 'https://api.airtable.com/v0/appZpGVmdenKv27KK/Shoppingcart';
        const getProductListAPI = 'https://api.airtable.com/v0/appZpGVmdenKv27KK/Product';
        const getShoppingcartList = async () => {
            const response = await fetch(getShoppingcartListAPI + '?view=Grid%20view', headers);
            const data = await response.json();
            return data;
        }
        const getProductList = async () => {
            const response = await fetch(getProductListAPI + '?view=Grid%20view', headers);
            const data = await response.json();
            return data;
        }

        function sum(sumeach, sumall) {
            return parseInt(sumeach) + parseInt(sumall);
        }

        $(document).ready(function() {
            getShoppingcartList().then(shoppingcartListData => { // *****先取得全部Shop*****
                const shoppingcartList = shoppingcartListData.records;
                console.log('shoppingcartList:', shoppingcartList);
                getProductList().then(ProductListData => { // *****再取得全部product*****
                    const productList = ProductListData.records;
                    console.log('productList:', productList);
                    var sumeach;
                    var sumall = 0;
                    $.each(productList, (index, product) => {
                        let productShoppingcart = [];
                        const productId = product.id;
                        const {
                            Pro_name,
                            Pro_price,
                            Pro_image,
                            Shoppingcart
                        } = product.fields;
                        if (Shoppingcart) { // *****如果此pro有shoppingcart
                            productShoppingcart = shoppingcartList.filter(shoppingcart => shoppingcart.fields.name[0] === productId); // *****在全部shop中找出此pro的shop*****
                            console.log('productShoppingcart:', productShoppingcart);
                            sumeach = productShoppingcart.map(item => item.fields.Shop_amount * Pro_price);
                            sumall = sum(sumall, sumeach);
                            $('#contains').append(
                                `
                            <table class="table table-borderless table-sm goods-text " align="">
                                <tr>
                                    <td rowspan="4"  width="240px"><img class="goods" src="${Pro_image}"></td>
                                    <td class="goods-price">$${Pro_price}</td>
                                </tr>
                                <tr>
                                    <td>${Pro_name}</td>
                                </tr>
                                <tr>
                                    <td>小計：</td>
                                    <td class="browser-default">$${sumeach}</td>
                                </tr>
                                <tr>
                                    <td>數量：</td>
                                    <td>
                                        <select class="browser-default custom-select">
                                            <option selected value="${productShoppingcart.map(item => (`${item.fields.Shop_amount}`))}">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                        </select>
                                    </td>

                                </tr>
                            </table>
                            `);
                        }
                    });
                    $('#total').append(
                        `
                        <h4 class="title">總額</h4>
                        <hr>
                        <p class="checkout">商品總價：$${sumall}</p>
                        <p class="checkout">運費：$100</p>
                        <p class="checkout">總額：$${sumall+100}</p>
                        <br>
                        <hr>
                        <p class="checkout">我們接受：</p>
                        <img class="creditcard" src="https://www.patriotfamilydental.com/wp-content/uploads/2016/08/accepted-creditcards.png">
                        <button class="btn btn-cart">
                             <a href="index-checkout.htm" class="color-wt">結帳</a>
                        </button>
                    `);
                });
            });
        });

    </script>

</head>

<body>



    <!--Navigation-->

    <header id="header-1" class="header">
        <nav class="header-nav">
            <a href="index.html">
                <img class="logo" src="img/logo.png">
            </a>
            <div class="search-button">
                <i class="fas fa-search search-toggle" data-selector="#header-1"></i>
            </div>
            <ul class="menu">
                <li><a href="index-search.html">食譜</a></li>
                <li><a href="#">會員專區</a></li>

                <li><a href="index-shoppingcart.html">購物車</a></li>
                <li><a href="index-login.html">Sign In</a></li>
            </ul>
            <div class="float-right">
                <form action="" class="search-box">
                    <input type="text" class="text search-input" placeholder="Type here to search..." />
                </form>
            </div>
        </nav>
    </header>

    <!--    Shoppingcart-->
    <div class="container1">
        <div class="row">
            <div class="col-md-6 bg-white">
                <h4 class="title">購物車</h4>
                <hr>
                <div class="col-md-12" id="contains">
                   
<!--
                    <table class="table table-sm goods-text">
                       
                        <tr>
                            <td rowspan="4" width="240px"><img class="goods" src="img/food3.jpg"></td>
                            <td class="goods-price">$168</td>
                        </tr>
                        <tr align="left">
                            <td>黃金炸豬排</td>
                        </tr>
                        <tr>
                            <td>&nbsp;</td>
                        </tr>
                        <tr>
                            <td>數量：</td>
                            <td>
                                <select class="browser-default custom-select">
                                    <option selected value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                </select>
                            </td>
                        </tr>
                    </table>
-->
                    
                    
                </div>
                <!--<<div class="col-md-12">-->
                <hr>
            </div>
            <!--<div class="col-md-6 bg-white">-->
            <div class="col-md-4 bg-white shop-check" id="total">
                <!--
                <h4 class="title">總額</h4>
                <hr>
                <p class="checkout">商品總價：$872</p>
                <p class="checkout">運費：$100</p>
                <br>
                <hr>
                <p class="checkout">我們接受：</p>
                <img class="creditcard" src="https://www.patriotfamilydental.com/wp-content/uploads/2016/08/accepted-creditcards.png">
                <button type="submit" class="btn btn-cart">
                    <a href="#" class="color-wt">結帳</a>
                </button>
-->
            </div>


        </div>
        <!--<div class="row">-->




        <!-- Footer -->
        <footer class="footer bg-light">
            <div class="container">
                <div class="row">
                    <div class="col-lg-6 h-100 text-center text-lg-left my-auto">
                        <ul class="list-inline mb-2">
                            <li class="list-inline-item">
                                <a class="info-text" href="#">About</a>
                            </li>
                            <li class="list-inline-item">&sdot;</li>
                            <li class="list-inline-item">
                                <a class="info-text" href="#">Contact</a>
                            </li>
                            <li class="list-inline-item">&sdot;</li>
                            <li class="list-inline-item">
                                <a class="info-text" href="#">Terms of Use</a>
                            </li>
                            <li class="list-inline-item">&sdot;</li>
                            <li class="list-inline-item">
                                <a href="#" class="info-text">Privacy Policy</a>
                            </li>
                        </ul>
                        <p class="text-muted small mb-4 mb-lg-0">&copy; Your Website 2019. All Rights Reserved.</p>
                    </div>
                    <div class="col-lg-6 h-100 text-center text-lg-right my-auto">
                        <ul class="list-inline mb-0">
                            <li class="list-inline-item mr-3">
                                <a class="info-text" href="#">
                                    <i class="fab fa-facebook fa-2x fa-fw"></i>
                                </a>
                            </li>
                            <li class="list-inline-item mr-3">
                                <a class="info-text" href="#">
                                    <i class="fab fa-twitter-square fa-2x fa-fw"></i>
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a class="info-text" href="#">
                                    <i class="fab fa-instagram fa-2x fa-fw"></i>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>

            </div>

        </footer>


        <!-- Bootstrap core JavaScript -->
        <script src="vendor/jquery/jquery.min.js"></script>
        <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>

        <script src="js/index.js"></script>
    </div>
    <!--<div class="container1">-->
</body>

</html>
