<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>食趣 - 一人的食材外送</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
    <link href="vendor/simple-line-icons/css/simple-line-icons.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet"
        type="text/css">

    <!-- Custom styles for this template -->
    <link href="css/detail.css" rel="stylesheet">
    <link href="css/landing-page.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">

    <script src="https://code.jquery.com/jquery-1.12.2.min.js"></script>
    <script src="node_modules/airtable/build/airtable.browser.js"></script>

</head>

<body>
    <!--     test-->
    <header id="header-1" class="header">
        <nav class="header-nav">
            <a href="index.html">
                <img class="logo" src="img/logo.png">
            </a>
            <div class="search-button">
                <i class="fas fa-search search-toggle" data-selector="#header-1"></i>
            </div>
            <ul class="menu">
                <li><a href="index-search.html">食譜</a></li>
                <li><a href="#">會員專區</a></li>
                <li><a href="index-shoppingcart.html">購物車</a></li>
                <li><a href="index-login.html">Sign In</a></li>
            </ul>
            <div class="float-right">
                <form action="" class="search-box">
                    <input type="text" class="text search-input" placeholder="Type here to search..." />
                </form>
            </div>
        </nav>
    </header>
    <div class="container">
        <div class="row">
            <div class="col-md-6 p-3 md-auto" id="img">
                <!--
                <img class="img2" src="img/detail.jpg">
                <br>
                <br>
                <h3 class="t1" id="name"></h3>
                <button type="button" class="btn btn-color-detail t2">加入購物車
                </button>
-->
            </div>
            <div class="col-md-6 mr-auto text2">
                <table class="table table-borderless" id="content">
                    <!-- <tr>
                        <td class="text">內容物</td>
                    </tr>
                    <tr>
                        <td>蝦仁 18隻</td>
                        <td>辣椒 適量</td>

                    </tr>
                    <tr>
                        <td>花生仁 適量</td>
                        <td>青蔥 1把</td>
                    </tr>
                    <tr>
                        <td>蒜頭 8顆</td>
                        <td>醬料包 1包</td>
                    </tr>
                    <tr>
                        <td>嫩薑 適量</td>
                    </tr> -->
                </table>
                <table class="table table-borderless" id="preserve">
                    <!--
                    <tr class="text">
                        <td>保存期限</td>
                    </tr>
                    <tr>
                        <td>各項食材以冷藏保存四天</td>
                    </tr>
-->
                </table>
                <!--
                <table class="table table-borderless">
                    <tr>
                        <td class="text">醬汁包內容</td>
                    </tr>
                    <tr>
                        <td>醬汁：醬油、糖、豆瓣醬、香油、米酒、太白粉</td>
                    </tr>
                </table>
-->
                <table class="table table-borderless" id="procedure">
                    <!--
<tr>
    <td class="text">作法</td>
</tr>
<tr>
    <td class="method">1. 乾辣椒對切取出辣椒籽，花生去膜。
        <br> 2. 蝦仁去腸泥吸乾水粉後，加入太白粉與蛋白抓勻。<br> 3. 將蔥切花，薑、蒜切末，將其餘醬汁與其混合。<br> 4. 熱油鍋，爆香花椒粒炒出香味，再加乾辣椒籽爆香，瀝出花椒油備用。<br> 5. 起油鍋，蝦仁下鍋過油約8秒即撈 出，瀝油。
        <br> 6. 以花椒油爆香薑末，加乾辣椒炒至膨脹，放入蒜末、蝦仁、醬汁炒勻，起鍋前倒入花生，淋少許白醋拌勻，灑蔥花即可。</td>
</tr>
-->
                </table>
            </div>
        </div>
    </div>
    <!-- Footer -->
    <footer class="footer bg-light">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 h-100 text-center text-lg-left my-auto">
                    <ul class="list-inline mb-2">
                        <li class="list-inline-item">
                            <a class="info-text" href="#">About</a>
                        </li>
                        <li class="list-inline-item">&sdot;</li>
                        <li class="list-inline-item">
                            <a class="info-text" href="#">Contact</a>
                        </li>
                        <li class="list-inline-item">&sdot;</li>
                        <li class="list-inline-item">
                            <a class="info-text" href="#">Terms of Use</a>
                        </li>
                        <li class="list-inline-item">&sdot;</li>
                        <li class="list-inline-item">
                            <a href="#" class="info-text">Privacy Policy</a>
                        </li>
                    </ul>
                    <p class="text-muted small mb-4 mb-lg-0">&copy; Your Website 2019. All Rights Reserved.</p>
                </div>
                <div class="col-lg-6 h-100 text-center text-lg-right my-auto">
                    <ul class="list-inline mb-0">
                        <li class="list-inline-item mr-3">
                            <a class="info-text" href="#">
                                <i class="fab fa-facebook fa-2x fa-fw"></i>
                            </a>
                        </li>
                        <li class="list-inline-item mr-3">
                            <a class="info-text" href="#">
                                <i class="fab fa-twitter-square fa-2x fa-fw"></i>
                            </a>
                        </li>
                        <li class="list-inline-item">
                            <a class="info-text" href="#">
                                <i class="fab fa-instagram fa-2x fa-fw"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
    <script src="js/index.js"></script>
</body>

<script>
    var Airtable = require('airtable');
    var base = new Airtable({
        apiKey: 'keyabYPbrYnSWmK9v'
    }).base('appZpGVmdenKv27KK');
    const url = new URL(window.location.href);
    const id = url.searchParams.get("id");
    base('Orderdetails').select({
        view: "Grid view"
    }).eachPage(function page(records, fetchNextPage) {
        console.log(records);
        base('Product').find(id, function (err, record) {
            if (err) {
                console.error(err);
                return;
            }
            console.log(record);
            $('#img').append(
                `
            <img align="center" class="img2" src="${record.fields.Pro_image}">
            <br><br>
            <div align="center" class="name">
            <h3 id="name" class="t1">${record.fields.Pro_name}  </h3>
            <a href="index-shoppingcart.html?id=${id}"><button type="button" class="btn btn-color-detail">加入購物車</button></a>  
            </div>
            `
            );
            var date;
            records.forEach(function (order, i) {
                if (order.fields.Pro_id == id) {
                    date = records[i].fields.Pro_expire_day;
                }
            });
            //console.log(date);
            $('#preserve').append(
                `
                <tr class="text">
                <td>保存期限</td>
                </tr>
                <tr>
                <td>各項食材以${record.fields.Pro_Pre_way}保存${date}天</td>
                </tr>
                    `
            );
            $('#procedure').append(
                `
            <tr>
            <td class="text">作法</td>
            </tr>
            <tr>
            <td class="method">${record.fields.Pro_procedure}</td>
            <tr>
                `
            );
        });
    });
    base('Pro_material').select({
        view: "Grid view"
    }).eachPage(function page(Promat, fetchNextPage) {
        console.log(Promat);
        base('Material').select({
            view: "Grid view"
        }).eachPage(function page(mat, fetchNextPage) {
            console.log(mat);
            base('Product').find(id, function (err, pro) {
                console.log(pro);
                //console.log(pro.fields.Pro_material);
                var linkedmatID = [];
                var amountarr = [];
                var x = 0;
                pro.fields.Pro_material.forEach(function (promatid, index) {
                    //console.log(promatid);
                    Promat.forEach(function (promat, i) {
                        //console.log("promat",promat.id);
                        if (promat.id === promatid) {
                            //console.log(Promat[i].fields.Mat_id[0]);
                            linkedmatID[i] = Promat[i].fields.Mat_id[0];
                            amountarr[x] = Promat[i].fields.Pro_mat_amount;
                            x++;
                        }

                    });
                });
                console.log(amountarr);
                var namearr = [];
                var h = 0;
                linkedmatID.forEach(function (matidd, m) {
                    //console.log(matidd);
                    mat.forEach(function (matid, a) {
                        if (matid.id === matidd) {
                            namearr[h] = mat[a].fields.Mat_name;
                            h++;
                        }
                    });
                });
                console.log(namearr);
                var sub = [];
                namearr.forEach(function (n, index){
                    sub[index] = n + " " + amountarr[index];
                });
                console.log(sub);
                $('#content').append(
                    `
                    <tr><td class="text">內容物</td></tr>
                `
                );
                var y = 0;
                for(var i=0; i<h; i+=2){
                    $('#content').append(
                        `
                        <tr>
                        <td>${sub[i]}</td>
                        <td>${sub[i+1]}</td>
                        </tr>
                        `
                    );
                }
            });
        });
    });
</script>

</html>
